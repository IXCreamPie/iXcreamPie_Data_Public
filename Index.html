<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Multi-Page Data Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: system-ui, sans-serif; margin:0; }
.tabs { display:flex; flex-wrap:wrap; border-bottom:1px solid #ccc; overflow-x:auto; }
.tab-button { padding:6px 12px; cursor:pointer; border:none; background:#f2f2f2; white-space:nowrap; }
.tab-button.active { background:#ddd; font-weight:bold; }
.sheet { padding:8px; }
table { border-collapse:collapse; width:100%; font-size:12px; }
th,td { border:1px solid #ccc; padding:4px; }
th { background:#eee; position:sticky; top:0; }
input { width:100%; box-sizing:border-box; }
a { cursor:pointer; color:blue; text-decoration:underline; }
</style>
</head>

<body>

<div class="tabs"></div>
<div class="sheet">
  <div id="page-container"></div>
</div>

<script>
/* ---------- SETTINGS ---------- */
const MAX_COLUMNS = 50;
const MAX_PAGES = 50;

let pages = JSON.parse(localStorage.getItem('pages')) || [];
let currentPageIndex = 0;

/* ---------- STORAGE ---------- */
function savePages(){
  localStorage.setItem('pages', JSON.stringify(pages));
}

/* ---------- PAGE MANAGEMENT ---------- */
function createPage(name){
  if(pages.length >= MAX_PAGES) return alert("Max pages reached");
  pages.push({
    id: crypto.randomUUID(),
    name: name || `Page ${pages.length+1}`,
    columns: [],
    rows: []
  });
  savePages();
  renderTabs();
  showPage(pages.length - 1);
}

function deletePage(index){
  if(!pages[index]) return;
  if(!confirm(`Delete "${pages[index].name}"?`)) return;

  pages.splice(index, 1);
  currentPageIndex = Math.max(0, currentPageIndex - 1);
  savePages();
  renderTabs();
  showPage(currentPageIndex);
}

/* ---------- TABS ---------- */
function renderTabs(){
  const bar = document.querySelector('.tabs');
  bar.innerHTML = '';
  pages.forEach((p,i)=>{
    const btn = document.createElement('button');
    btn.className = 'tab-button' + (i===currentPageIndex ? ' active':'');
    btn.textContent = p.name;
    btn.onclick = ()=>showPage(i);
    bar.appendChild(btn);
  });
}

/* ---------- RENDER PAGE ---------- */
function showPage(index){
  if(!pages[index]) return;
  currentPageIndex = index;
  renderTabs();

  const page = pages[index];
  const container = document.getElementById('page-container');
  container.innerHTML = '';

  const table = document.createElement('table');
  const thead = document.createElement('thead');
  const hrow = document.createElement('tr');

  page.columns.forEach(col=>{
    const th = document.createElement('th');
    th.textContent = col;
    hrow.appendChild(th);
  });

  thead.appendChild(hrow);
  table.appendChild(thead);

  const tbody = document.createElement('tbody');

  page.rows.forEach((row,rIdx)=>{
    const tr = document.createElement('tr');
    row.forEach((cell,cIdx)=>{
      const td = document.createElement('td');
      td.innerHTML = renderCell(cell);
      td.ondblclick = ()=>editCell(td, cell);
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });

  table.appendChild(tbody);
  container.appendChild(table);
}

/* ---------- CELLS ---------- */
function renderCell(cell){
  if(!cell) return '';
  if(cell.link){
    return `<a onclick="jumpToPage(${cell.link.page},${cell.link.row})">${cell.value}</a>`;
  }
  return cell.value || '';
}

function editCell(td, cell){
  const input = document.createElement('input');
  input.value = cell.value || '';
  td.innerHTML = '';
  td.appendChild(input);
  input.focus();

  input.onblur = ()=>{
    cell.value = input.value;
    td.innerHTML = renderCell(cell);
    savePages();
  };

  input.onkeydown = e=>{
    if(e.key === 'Enter') input.blur();
  };
}

/* ---------- NAV ---------- */
function jumpToPage(p,r){
  if(!pages[p]) return;
  showPage(p);
  setTimeout(()=>{
    const row = document.querySelectorAll('tbody tr')[r];
    if(row){
      row.scrollIntoView({behavior:'smooth',block:'center'});
      row.style.background='#fffa90';
      setTimeout(()=>row.style.background='',1200);
    }
  },100);
}

/* ---------- CSV ---------- */
function exportCurrentPageCSV(){
  const page = pages[currentPageIndex];
  if(!page) return;

  const lines = [
    page.columns.join(',')
  ];

  page.rows.forEach(r=>{
    lines.push(r.map(c=>`"${(c.value||'').replace(/"/g,'""')}"`).join(','));
  });

  const blob = new Blob([lines.join('\n')], {type:'text/csv'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = page.name + '.csv';
  a.click();
}

/* ---------- INIT ---------- */
if(pages.length === 0) createPage();
renderTabs();
showPage(currentPageIndex);
</script>

</body>
</html>
